<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>开奖数字验证器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 二次元背景样式（使用你提供的图片） */
        body {
            background: url('https://i.imgur.com/xxxxxx.jpg') no-repeat center center fixed; /* 替换为图片的实际URL（需先上传图片到图床） */
            background-size: cover;
            backdrop-filter: blur(10px);
        }
        .digit-item {
            width: 40px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            margin: 0 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .trigger-tag {
            background: #ffecec;
            color: #e53e3e;
            padding: 4px 8px;
            border-radius: 4px;
            margin: 0 2px;
            font-size: 0.9em;
        }
        .history-item {
            padding: 8px 0;
            border-bottom: 1px solid rgba(240, 240, 240, 0.5);
            transition: background 0.2s;
        }
        .history-item:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        /* 作者信息样式 */
        .author-info {
            text-align: center;
            color: #555;
            font-size: 0.9em;
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px solid rgba(240, 240, 240, 0.5);
        }
        /* 卡片美化 */
        .card {
            background: rgba(255, 255, 255, 0.85);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            backdrop-filter: blur(8px);
        }
    </style>
</head>
<body class="min-h-screen p-4 flex flex-col items-center">
    <!-- 主容器 -->
    <div class="w-full max-w-md card p-6">
        <h2 class="text-2xl font-bold text-center mb-2 text-pink-600">开奖数字验证器</h2>
        <p class="text-gray-500 text-center mb-6">自动获取开奖号并验证组合</p>

        <!-- API数据区 -->
        <div class="bg-white/70 rounded-lg p-4 mb-6">
            <div class="flex justify-between items-center mb-2">
                <span class="text-gray-600">开奖数据</span>
                <button id="refreshBtn" class="bg-pink-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-pink-600 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>
                        <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"/>
                    </svg>
                    刷新开奖号
                </button>
            </div>
            <p class="text-sm text-gray-500">自动从API获取最新开奖号，提取5位数字进行验证</p>
        </div>

        <!-- 当前开奖数字+后四和值（横向显示） -->
        <div class="bg-white/70 rounded-lg p-4 mb-6">
            <div class="flex justify-between items-center mb-3">
                <span class="text-gray-600">当前开奖号</span>
                <div class="text-sm">
                    <span class="text-gray-500">后四和值：</span>
                    <span id="lastFourSum" class="font-medium text-blue-600">25</span>
                </div>
            </div>
            <div class="flex justify-center gap-2" id="digitList">
                <!-- 数字动态生成（横向） -->
            </div>
        </div>

        <!-- 验证结果区 -->
        <div id="resultBox" class="mb-6">
            <!-- 结果图标（叉/勾） -->
            <div class="text-center mb-4" id="resultIcon">
                <!-- 动态插入图标 -->
            </div>
            <!-- 触发条件（仅触发时显示） -->
            <div id="triggerArea" class="hidden bg-pink-50/80 border border-pink-200 rounded-lg p-3 mb-4">
                <p class="text-pink-700 font-medium mb-1">触发条件：</p>
                <p class="text-pink-600" id="triggerText"><span class="font-medium">• 顺子（3个及以上连续数字）</span></p>
                <p class="text-pink-600 text-sm mt-1">触发组合：</p>
                <div id="triggerCombos" class="flex flex-wrap gap-2">
                    <span class="trigger-tag">789</span>
                </div>
            </div>
            <!-- 验证规则 -->
            <div class="bg-white/70 rounded-lg p-3">
                <p class="text-gray-700 font-medium mb-2">验证规则：</p>
                <ul class="text-gray-600 text-sm space-y-1">
                    <li>• 3个及以上连续数字（不看顺序，如18179中的789）</li>
                    <li>• 3个及以上重复数字（不看顺序，如18171中的111）</li>
                    <li>• 两对相同数字（不看顺序，如11828中的11、88）</li>
                    <li>• 两组三位数和为10/20的组合（不看顺序）</li>
                </ul>
            </div>
        </div>

        <!-- 历史数据区（100期） -->
        <div class="mt-8">
            <h3 class="text-lg font-bold text-gray-800 mb-3 text-center">历史开奖记录（100期）</h3>
            <div id="historyList" class="max-h-80 overflow-y-auto bg-white/70 rounded-lg p-3">
                <div class="history-item text-center text-gray-500">加载中...</div>
            </div>
        </div>

        <!-- 作者信息 -->
        <div class="author-info">
            <p>瞳Yy 制作 · 免费使用</p>
        </div>
    </div>

    <script>
        const LATEST_API = "https://qqtj666.com/api/trial/draw-result?code=trxbhffc&rows=1";
        let currentDigits = []; // 当前5位开奖数字
        let historyData = []; // 历史记录（100期）

        // 1. 获取最新开奖号
        async function fetchLatestDraw() {
            try {
                const res = await fetch(LATEST_API);
                const data = await res.json();
                if (data.code === 0 && data.data.length > 0) {
                    const drawResult = data.data[0].drawResult;
                    currentDigits = drawResult.split(',').filter(n => /\d/.test(n)).slice(0, 5);
                    return true;
                }
                return false;
            } catch (err) {
                console.error('最新开奖API请求失败：', err);
                alert('获取最新开奖号失败，请重试');
                return false;
            }
        }

        // 2. 获取100期历史开奖数据（修复跨域+分页）
        async function fetchHistoryDraw() {
            try {
                historyData = [];
                // 分页获取100期（每页10条，取10页）
                for (let page = 1; page <= 10; page++) {
                    const res = await fetch(`https://qqtj666.com/api/trial/draw-result?code=trxbhffc&rows=10&page=${page}`);
                    const data = await res.json();
                    if (data.code !== 0 || !data.data.length) break;
                    
                    // 解析当前页数据
                    const pageData = data.data.map(item => {
                        const digits = item.drawResult.split(',').filter(n => /\d/.test(n)).slice(0, 5);
                        const lastFourSum = digits.slice(1).map(n => parseInt(n)).reduce((a,b)=>a+b, 0);
                        const validateRes = validateDigits(digits);
                        return {
                            digits: digits.join(' '),
                            sum: lastFourSum,
                            result: validateRes.pass ? '✅' : '❌'
                        };
                    });
                    historyData = [...historyData, ...pageData];
                    if (historyData.length >= 100) break;
                }
                return true;
            } catch (err) {
                console.error('历史开奖API请求失败：', err);
                return false;
            }
        }

        // 3. 计算后四数字的和值
        function calcLastFourSum() {
            if (currentDigits.length < 4) return 0;
            const lastFour = currentDigits.slice(1).map(n => parseInt(n));
            return lastFour.reduce((a, b) => a + b, 0);
        }

        // 4. 渲染当前开奖数字（横向）和后四和值
        function renderDigitsAndSum() {
            const digitList = document.getElementById('digitList');
            digitList.innerHTML = '';
            currentDigits.forEach(num => {
                const div = document.createElement('div');
                div.className = 'digit-item';
                div.textContent = num;
                digitList.appendChild(div);
            });
            document.getElementById('lastFourSum').textContent = calcLastFourSum();
        }

        // 5. 验证数字规则
        function validateDigits(digits) {
            const numArr = digits.map(n => parseInt(n));
            const sortedNums = [...numArr].sort((a, b) => a - b);
            let result = { 
                pass: true, 
                trigger: '', 
                combos: [] 
            };

            // 规则1：3个及以上连续数字
            let maxSeq = 1;
            let currentSeq = 1;
            let seqCombos = [];
            for (let i = 1; i < sortedNums.length; i++) {
                if (sortedNums[i] === sortedNums[i-1] + 1) {
                    currentSeq++;
                    if (currentSeq >= 3) {
                        const combo = sortedNums.slice(i - currentSeq + 1, i + 1).join('');
                        if (!seqCombos.includes(combo)) seqCombos.push(combo);
                    }
                    maxSeq = Math.max(maxSeq, currentSeq);
                } else {
                    currentSeq = 1;
                }
            }
            if (maxSeq >= 3) {
                result.pass = false;
                result.trigger = '顺子（3个及以上连续数字）';
                result.combos = seqCombos;
                return result;
            }

            // 规则2：3个及以上重复数字
            const countMap = {};
            numArr.forEach(n => countMap[n] = (countMap[n] || 0) + 1);
            const repeatNums = Object.keys(countMap).filter(k => countMap[k] >= 3);
            if (repeatNums.length > 0) {
                result.pass = false;
                result.trigger = '3个及以上重复数字';
                result.combos = repeatNums.map(n => n.repeat(3));
                return result;
            }

            // 规则3：两对相同数字
            const pairNums = Object.keys(countMap).filter(k => countMap[k] >= 2);
            if (pairNums.length >= 2) {
                result.pass = false;
                result.trigger = '两对相同数字';
                result.combos = pairNums.map(n => n.repeat(2));
                return result;
            }

            // 规则4：两组三位数和为10/20
            const allTriples = [];
            const tripleSums = [];
            for (let i = 0; i < 5; i++) {
                for (let j = i+1; j < 5; j++) {
                    for (let k = j+1; k < 5; k++) {
                        const triple = [numArr[i], numArr[j], numArr[k]];
                        const sum = triple.reduce((a,b)=>a+b, 0);
                        if (sum === 10 || sum === 20) {
                            const sortedTriple = triple.sort((a,b)=>a-b).join('');
                            if (!allTriples.includes(sortedTriple)) {
                                allTriples.push(sortedTriple);
                                tripleSums.push(`${sortedTriple}=${sum}`);
                            }
                        }
                    }
                }
            }
            if (allTriples.length >= 2) {
                result.pass = false;
                result.trigger = '两组三位数和为10/20';
                result.combos = tripleSums;
                return result;
            }

            return result;
        }

        // 6. 展示验证结果
        function showValidationResult(validateRes) {
            const resultIcon = document.getElementById('resultIcon');
            const triggerArea = document.getElementById('triggerArea');
            const triggerText = document.getElementById('triggerText');
            const triggerCombos = document.getElementById('triggerCombos');

            if (validateRes.pass) {
                resultIcon.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="#22c55e" viewBox="0 0 16 16">
                        <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
                    </svg>
                `;
                triggerArea.classList.add('hidden');
            } else {
                resultIcon.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="#e53e3e" viewBox="0 0 16 16">
                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                    </svg>
                `;
                triggerArea.classList.remove('hidden');
                triggerText.innerHTML = `<span class="font-medium">• ${validateRes.trigger}</span>`;
                triggerCombos.innerHTML = '';
                validateRes.combos.forEach(combo => {
                    const span = document.createElement('span');
                    span.className = 'trigger-tag';
                    span.textContent = combo;
                    triggerCombos.appendChild(span);
                });
            }
        }

        // 7. 渲染100期历史记录
        function renderHistory() {
            const historyList = document.getElementById('historyList');
            if (historyData.length === 0) {
                historyList.innerHTML = '<div class="history-item text-center text-gray-500">暂无历史记录</div>';
                return;
            }
            historyList.innerHTML = '';
            historyData.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item flex justify-between items-center px-2';
                div.innerHTML = `
                    <span class="font-medium">${item.digits}</span>
                    <span>和值：${item.sum}</span>
                    <span>${item.result}</span>
                `;
                historyList.appendChild(div);
            });
        }

        // 8. 初始化
        async function init() {
            // 同时加载最新和历史数据
            const [latestSuccess, historySuccess] = await Promise.all([
                fetchLatestDraw(),
                fetchHistoryDraw()
            ]);
            if (latestSuccess) {
                renderDigitsAndSum();
                const validateRes = validateDigits(currentDigits);
                showValidationResult(validateRes);
            }
            if (historySuccess) {
                renderHistory();
            }
        }
        // 页面加载时初始化
        window.onload = init;
        // 刷新按钮点击事件
        document.getElementById('refreshBtn').addEventListener('click', init);
    </script>
</body>
</html>
