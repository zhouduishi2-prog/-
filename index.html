<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>开奖数字验证器（实时刷新版）</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 清晰背景：虚化2px，保留图案且不影响操作 */
        body {
            background: url('https://youke.xn--y7xa690gmna.cn/s1/2026/02/01/697ef865dbe34.webp') no-repeat center center fixed;
            background-size: cover;
            backdrop-filter: blur(2px);
        }
        .digit-item {
            width: 40px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.95);
            margin: 0 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }
        .trigger-tag {
            background: #ffecec;
            color: #e53e3e;
            padding: 4px 8px;
            border-radius: 4px;
            margin: 0 2px;
            font-size: 0.9em;
        }
        .history-item {
            padding: 8px 0;
            border-bottom: 1px solid rgba(240, 240, 240, 0.7);
            transition: background 0.2s;
        }
        .history-item:hover {
            background: rgba(255, 255, 255, 0.8);
        }
        .author-info {
            text-align: center;
            color: #555;
            font-size: 0.9em;
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px solid rgba(240, 240, 240, 0.7);
        }
        .card {
            background: rgba(255, 255, 255, 0.92);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            backdrop-filter: blur(4px);
        }
        /* 北京时间美化 */
        .time-container {
            background: linear-gradient(135deg, #fef7fb 0%, #fcf1f7 100%);
            border-radius: 8px;
            padding: 8px 12px;
            box-shadow: 0 2px 6px rgba(236, 72, 153, 0.1);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .time-icon {
            color: #ec4899;
            font-size: 1.2em;
        }
        .time-text {
            font-size: 1.05em;
            font-weight: 500;
            color: #2d3748;
            letter-spacing: 0.5px;
        }
        .refresh-tip {
            font-size: 0.85em;
            color: #ff3d00; /* 实时刷新提示标红，醒目 */
            font-weight: 500;
            text-align: center;
            margin-bottom: 4px;
        }
        /* 时间格式期号（如202602010305） */
        .period-number {
            color: #2563eb;
            font-weight: 600;
            min-width: 120px;
            text-align: center;
            font-size: 0.9em;
            letter-spacing: 0.5px;
        }
        .bg-white\/70 {
            background: rgba(255, 255, 255, 0.9);
        }
    </style>
</head>
<body class="min-h-screen p-4 flex flex-col items-center">
    <!-- 顶部：北京时间+实时刷新提示 -->
    <div class="w-full max-w-md mb-3 flex justify-between items-center">
        <div class="time-container">
            <span class="time-icon">⏰</span>
            <span class="time-text" id="beijingTime">加载中...</span>
        </div>
        <div class="refresh-tip">实时刷新：0.5秒/次</div>
    </div>

    <!-- 主容器 -->
    <div class="w-full max-w-md card p-6">
        <h2 class="text-2xl font-bold text-center mb-2 text-pink-600">开奖数字验证器</h2>
        <p class="text-gray-500 text-center mb-6">自动获取开奖号并验证组合</p>

        <!-- API数据区 -->
        <div class="bg-white/70 rounded-lg p-4 mb-6">
            <div class="flex justify-between items-center mb-2">
                <span class="text-gray-600">开奖数据</span>
                <button id="refreshBtn" class="bg-pink-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-pink-600 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>
                        <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"/>
                    </svg>
                    手动刷新
                </button>
            </div>
            <p class="text-sm text-gray-500">自动从API获取最新开奖号，提取5位数字进行验证</p>
        </div>

        <!-- 当前开奖数字+后四和值 -->
        <div class="bg-white/70 rounded-lg p-4 mb-6">
            <div class="flex justify-between items-center mb-3">
                <span class="text-gray-600">当前开奖号</span>
                <div class="text-sm">
                    <span class="text-gray-500">后四和值：</span>
                    <span id="lastFourSum" class="font-medium text-blue-600">25</span>
                </div>
            </div>
            <div class="flex justify-center gap-2" id="digitList"></div>
        </div>

        <!-- 验证结果区 -->
        <div id="resultBox" class="mb-6">
            <div class="text-center mb-4" id="resultIcon"></div>
            <div id="triggerArea" class="hidden bg-pink-50/80 border border-pink-200 rounded-lg p-3 mb-4">
                <p class="text-pink-700 font-medium mb-1">触发条件：</p>
                <p class="text-pink-600" id="triggerText"><span class="font-medium">• 顺子（3个及以上连续数字）</span></p>
                <p class="text-pink-600 text-sm mt-1">触发组合：</p>
                <div id="triggerCombos" class="flex flex-wrap gap-2">
                    <span class="trigger-tag">789</span>
                </div>
            </div>
            <!-- 验证规则 -->
            <div class="bg-white/70 rounded-lg p-3">
                <p class="text-gray-700 font-medium mb-2">验证规则：</p>
                <ul class="text-gray-600 text-sm space-y-1">
                    <li>• 3个及以上连续数字（不看顺序，如18179中的789）</li>
                    <li>• 3个及以上重复数字（不看顺序，如18171中的111）</li>
                    <li>• 两对相同数字（不看顺序，如11828中的11、88）</li>
                    <li>• 两组三位数和为10/20的组合（不看顺序）</li>
                </ul>
            </div>
        </div>

        <!-- 历史数据区（1000期） -->
        <div class="mt-8">
            <h3 class="text-lg font-bold text-gray-800 mb-3 text-center">历史开奖记录（1000期，无重复）</h3>
            <div id="historyList" class="max-h-80 overflow-y-auto bg-white/70 rounded-lg p-3">
                <div class="history-item text-center text-gray-500">加载中...</div>
            </div>
        </div>

        <!-- 作者信息 -->
        <div class="author-info">
            <p>瞳Yy 制作 · 免费使用</p>
        </div>
    </div>

    <script>
        const LATEST_API = "https://qqtj666.com/api/trial/draw-result?code=trxbhffc&rows=1";
        let currentDigits = []; // 当前5位开奖数字
        let historyData = JSON.parse(localStorage.getItem('drawHistory')) || []; // 历史记录：本地持久化
        const MAX_HISTORY = 1000; // 历史记录上限1000期
        const REFRESH_INTERVAL = 500; // 实时刷新：0.5秒（500毫秒）
        let isRefreshing = false; // 防重复请求锁

        // 北京时间显示（带秒）
        function updateBeijingTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('beijingTime').innerText = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }
        setInterval(updateBeijingTime, 1000);
        updateBeijingTime(); // 初始化

        // 生成时间格式期号（年月日时分，如202602010305）
        function generateTimePeriod() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            return `${year}${month}${day}${hours}${minutes}`;
        }

        // 判断开奖数字是否重复（根据5位数字组合去重）
        function isDuplicateDigit(digits) {
            const digitStr = digits.join('');
            return historyData.some(item => item.digitStr === digitStr);
        }

        // 1. 获取最新开奖号（实时刷新+防重复请求）
        async function fetchLatestDraw() {
            if (isRefreshing) return; // 正在请求则跳过，避免接口压力
            isRefreshing = true;
            try {
                const res = await fetch(LATEST_API);
                const data = await res.json();
                if (data.code === 0 && data.data.length > 0) {
                    const drawResult = data.data[0].drawResult;
                    currentDigits = drawResult.split(',').filter(n => /\d/.test(n)).slice(0, 5);
                    // 去重：重复则不添加到历史
                    if (!isDuplicateDigit(currentDigits)) {
                        addToHistory(currentDigits);
                    }
                    isRefreshing = false;
                    return true;
                }
                isRefreshing = false;
                return false;
            } catch (err) {
                console.error('最新开奖API请求失败：', err);
                isRefreshing = false;
                return false;
            }
        }

        // 2. 存入历史（时间格式期号+去重）
        function addToHistory(digits) {
            const digitStr = digits.join('');
            const period = generateTimePeriod(); // 期号=年月日时分（如202602010305）
            const lastFourSum = digits.slice(1).map(n => parseInt(n)).reduce((a,b)=>a+b, 0);
            const validateRes = validateDigits(digits);
            const historyItem = {
                period: period, // 时间格式期号
                digitStr: digitStr, // 用于去重的数字字符串
                digits: digits.join(' '),
                sum: lastFourSum,
                result: validateRes.pass ? '✅' : '❌',
                time: new Date().toLocaleString('zh-CN', {timeZone: 'Asia/Shanghai'})
            };
            // 满1000期删除最早1期
            if (historyData.length >= MAX_HISTORY) {
                historyData.shift();
            }
            historyData.unshift(historyItem); // 最新的放最前面
            localStorage.setItem('drawHistory', JSON.stringify(historyData));
        }

        // 3. 兼容原历史API，补充至1000期（去重+补时间期号）
        async function fetchHistoryDraw() {
            try {
                // 本地已有历史，直接用，无则从API拉取
                if (historyData.length > 0) return true;
                // 分页拉取（最多补至1000期）
                for (let page = 1; page <= 100; page++) {
                    const res = await fetch(`https://qqtj666.com/api/trial/draw-result?code=trxbhffc&rows=10&page=${page}`);
                    const data = await res.json();
                    if (data.code !== 0 || !data.data.length) break;
                    const pageData = data.data.map(item => {
                        const digits = item.drawResult.split(',').filter(n => /\d/.test(n)).slice(0, 5);
                        const digitStr = digits.join('');
                        const period = generateTimePeriod(); // 补历史期号（用当前时间，实际可根据API时间调整）
                        const lastFourSum = digits.slice(1).map(n => parseInt(n)).reduce((a,b)=>a+b, 0);
                        const validateRes = validateDigits(digits);
                        return {
                            period: period,
                            digitStr: digitStr,
                            digits: digits.join(' '),
                            sum: lastFourSum,
                            result: validateRes.pass ? '✅' : '❌',
                            time: item.drawTime || new Date().toLocaleString('zh-CN')
                        };
                    });
                    // 去重后添加
                    const uniqueData = pageData.filter(item => !historyData.some(h => h.digitStr === item.digitStr));
                    historyData = [...historyData, ...uniqueData];
                    if (historyData.length >= MAX_HISTORY) break;
                }
                localStorage.setItem('drawHistory', JSON.stringify(historyData));
                return true;
            } catch (err) {
                console.error('历史开奖API请求失败：', err);
                return false;
            }
        }

        // 4. 计算后四数字的和值
        function calcLastFourSum() {
            if (currentDigits.length < 4) return 0;
            const lastFour = currentDigits.slice(1).map(n => parseInt(n));
            return lastFour.reduce((a, b) => a + b, 0);
        }

        // 5. 渲染当前开奖数字（横向）和后四和值
        function renderDigitsAndSum() {
            const digitList = document.getElementById('digitList');
            digitList.innerHTML = '';
            currentDigits.forEach(num => {
                const div = document.createElement('div');
                div.className = 'digit-item';
                div.textContent = num;
                digitList.appendChild(div);
            });
            document.getElementById('lastFourSum').textContent = calcLastFourSum();
        }

        // 6. 修复后的验证数字规则（补全“两组三位数和为10”的判断）
        function validateDigits(digits) {
            const numArr = digits.map(n => parseInt(n));
            const sortedNums = [...numArr].sort((a, b) => a - b);
            let result = { 
                pass: true, 
                trigger: '', 
                combos: [] 
            };

            // 规则1：3个及以上连续数字
            let maxSeq = 1;
            let currentSeq = 1;
            let seqCombos = [];
            for (let i = 1; i < sortedNums.length; i++) {
                if (sortedNums[i] === sortedNums[i-1] + 1) {
                    currentSeq++;
                    if (currentSeq >= 3) {
                        const combo = sortedNums.slice(i - currentSeq + 1, i + 1).join('');
                        if (!seqCombos.includes(combo)) seqCombos.push(combo);
                    }
                    maxSeq = Math.max(maxSeq, currentSeq);
                } else {
                    currentSeq = 1;
                }
            }
            if (maxSeq >= 3) {
                result.pass = false;
                result.trigger = '顺子（3个及以上连续数字）';
                result.combos = seqCombos;
                return result;
            }

            // 规则2：3个及以上重复数字
            const countMap = {};
            numArr.forEach(n => countMap[n] = (countMap[n] || 0) + 1);
            const repeatNums = Object.keys(countMap).filter(k => countMap[k] >= 3);
            if (repeatNums.length > 0) {
                result.pass = false;
                result.trigger = '3个及以上重复数字';
                result.combos = repeatNums.map(n => n.repeat(3));
                return result;
            }

            // 规则3：两对相同数字
            const pairNums = Object.keys(countMap).filter(k => countMap[k] >= 2);
            if (pairNums.length >= 2) {
                result.pass = false;
                result.trigger = '两对相同数字';
                result.combos = pairNums.map(n => n.repeat(2));
                return result;
            }

            // 规则4：修复！两组三位数和为10/20的组合
            const allTriples = [];
            const tripleSums = [];
            // 遍历所有可能的三位数组合（不重复）
            for (let i = 0; i < 5; i++) {
                for (let j = i+1; j < 5; j++) {
                    for (let k = j+1; k < 5; k++) {
                        const triple = [numArr[i], numArr[j], numArr[k]];
                        const sum = triple.reduce((a,b)=>a+b, 0);
                        if (sum === 10 || sum === 20) {
                            const sortedTriple = triple.sort((a,b)=>a-b).join('');
                            if (!allTriples.includes(sortedTriple)) {
                                allTriples.push(sortedTriple);
                                tripleSums.push(`${sortedTriple}=${sum}`);
                            }
                        }
                    }
                }
            }
            // 只要有≥2组，就触发
            if (allTriples.length >= 2) {
                result.pass = false;
                result.trigger = '两组三位数和为10/20';
                result.combos = tripleSums;
                return result;
            }

            return result;
        }

        // 7. 展示验证结果
        function showValidationResult(validateRes) {
            const resultIcon = document.getElementById('resultIcon');
            const triggerArea = document.getElementById('triggerArea');
            const triggerText = document.getElementById('triggerText');
            const triggerCombos = document.getElementById('triggerCombos');

            if (validateRes.pass) {
                resultIcon.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="#22c55e" viewBox="0 0 16 16">
                        <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
                    </svg>
                `;
                triggerArea.classList.add('hidden');
            } else {
                resultIcon.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="#e53e3e" viewBox="0 0 16 16">
                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                    </svg>
                `;
                triggerArea.classList.remove('hidden');
                triggerText.innerHTML = `<span class="font-medium">• ${validateRes.trigger}</span>`;
                triggerCombos.innerHTML = '';
                validateRes.combos.forEach(combo => {
                    const span = document.createElement('span');
                    span.className = 'trigger-tag';
                    span.textContent = combo;
                    triggerCombos.appendChild(span);
                });
            }
        }

        // 8. 渲染历史记录（时间格式期号+去重）
        function renderHistory() {
            const historyList = document.getElementById('historyList');
            if (historyData.length === 0) {
                historyList.innerHTML = '<div class="history-item text-center text-gray-500">暂无历史记录</div>';
                return;
            }
            historyList.innerHTML = '';
            historyData.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item flex justify-between items-center px-2';
                div.innerHTML = `
                    <span class="period-number">${item.period}</span> <!-- 时间格式期号 -->
                    <span class="font-medium">${item.digits}</span>
                    <span>和值：${item.sum}</span>
                    <span>${item.result}</span>
                `;
                historyList.appendChild(div);
            });
        }

        // 9. 初始化+实时自动刷新
        async function init() {
            // 同时加载最新和历史数据
            const [latestSuccess, historySuccess] = await Promise.all([
                fetchLatestDraw(),
                fetchHistoryDraw()
            ]);
            if (latestSuccess) {
                renderDigitsAndSum();
                const validateRes = validateDigits(currentDigits);
                showValidationResult(validateRes);
            }
            if (historySuccess) {
                renderHistory();
            }
        }
        // 页面加载时初始化
        window.onload = init;
        // 手动刷新按钮点击事件
        document.getElementById('refreshBtn').addEventListener('click', init);
        // 启动实时自动刷新（0.5秒/次）
        setInterval(init, REFRESH_INTERVAL);

        // 可选：清空历史按钮（需手动加按钮，这里给函数）
        function clearHistory() {
            if(confirm('确定清空1000期历史记录？')){
                historyData = [];
                localStorage.removeItem('drawHistory');
                renderHistory();
            }
        }
    </script>
</body>
</html>
